---
title:  "[react] 리액트 웹소켓 Websocket - 컴포넌트 마운트시 바로 웹소켓 구동이 안되는 Error "

categories:
  - reactjs 
tags:
  - [react, webSocket,sockjs]

toc: true
toc_sticky: true

date: 2022-02-14

---

### 문제상황

> 웹소켓 핸드쉐이킹 후 구독을 하는데 처음 컴포넌트가 마운트 될 때 웹소켓 연결이 되지 않았고, 코드를 한 번 아무곳이나 더미로 수정한 후 리액트의 핫 리로딩을 강제로 시켜줬을때 비로소 웹소켓 연결과 구독이
실행되었다. 한번 왜 강제로 리랜더를 시켜줘야할까?

프로젝트로 리액트에서 웹소켓을 이용할 일이 있었다. 백엔드는 스프링으로 구현되어있기 떄문에 스프링에 최적화된 stomp 를 사용했다.

인스타그램의 Direct Message 와 같은 기능을 구현하고 있어서 나의 이름으로 온 메시지를 항상 확인해야한다.그러므로 컴포넌트가 마운트 되자마자 나의 이름을 항상 구독하고 있어야한다.

`sockjs-client` 라이브러리와 `stompjs` 라이브러리를 사용했다.


### 문제해결

왜 강제로 리랜더를 시켜줘야 비로소 웹소켓이 연결 및 구동이 될까? 라는 고민을 했는데 처음에 핸드쉐이킹 하는 부분에 오류가 있었다.


![image](https://user-images.githubusercontent.com/69495129/153780985-497f8e13-f5a9-487d-a029-dccf4cac24d1.png)

원래는 위 사진과 같이 컴포넌트의 바깥쪽에 상수와 변수를 선언했다. 

아래와 같이 Direct Component(웹소켓 연결하는 컴포넌트) 안에 핸드쉐이킹을 하는 변수와 상수를 선언해주자 useEffect 를 통해서 웹소켓 연결하는 코드가 제대로 실행되었다!

![image](https://user-images.githubusercontent.com/69495129/153781017-60cb4290-3b84-4084-b760-e24f75e21bb7.png)



***
<br>

    🌜 주관적인 견해가 담긴 글입니다. 다양한 의견이 있으실 경우
    언제든지 댓글 혹은 메일로 지적해주시면 감사하겠습니다! 😄

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}

